<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script async src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <title>LINE Front-end Framework - 麻雀</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script>
    function initializeLiff(myLiffId) {
      liff.init({
        liffId: myLiffId
      })
      .then(() => {
          initializeApp();
      })
      .catch((err) => {
          document.getElementById("liffAppContent").classList.add('hidden');
          document.getElementById("liffInitErrorMessage").classList.remove('hidden');
      });
    }
    const buttonPost = document.querySelector('#post-message')
    buttonPost.addEventListener('click', function() {
      if(!liff.isInClient()) {
        console.error('Fail to initialize')
        return
      }
      const canvas = document.querySelector('canvas')
      const base64Image = canvas.toDataURL().replace('data:image/png;base64,', '')
      const requestBody = new FormData()
      requestBody.append('image', base64Image)
      requestBody.append('type', 'base64')
      /* Upload Image */
      fetch('https://api.imgur.com/3/upload', {
      })
      .then(function(res) {
        return res.json()
      })
      .then(function(imageData) {
        liff.sendMessages([{
          'type': 'image',
          'originalContentUrl': imageData.link
        }])
      })
      .catch(function(e) {
        console.error(e)
      })
    })
  </script>
</html>
